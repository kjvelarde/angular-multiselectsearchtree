!function(){"use strict";angular.module("multiselect-searchtree",[])}(),function(){"use strict";var a=angular.module("multiselect-searchtree");a.controller("multiSelectTreeCtrl",["$scope","$document",function(a,b){function d(){e(),a.$apply()}function e(){a.showTree=!1,c&&(c.isActive=!1,c=void 0),b.off("click",d)}function f(b){for(var c=0,d=b.length;c<d;c++)g(b[c])||b[c].selected!==!0?g(b[c])&&b[c].selected===!1&&(b[c].selected=!0):a.selectedItems.push(b[c]),b[c]&&b[c].children&&f(b[c].children)}function g(b){var c=!1;if(a.selectedItems)for(var d=0;d<a.selectedItems.length;d++)if(a.selectedItems[d].id===b.id){c=!0;break}return c}var c;a.showTree=!1,a.selectedItems=[],a.multiSelect=a.multiSelect||!1,a.onActiveItem=function(a){c!==a&&(c&&(c.isActive=!1),c=a,c.isActive=!0)},a.refreshOutputModel=function(){a.outputModel=angular.copy(a.selectedItems)},a.refreshSelectedItems=function(){a.selectedItems=[],a.inputModel&&f(a.inputModel)},a.deselectItem=function(b,c){c.stopPropagation(),a.selectedItems.splice(a.selectedItems.indexOf(b),1),b.selected=!1,this.refreshOutputModel()},a.onControlClicked=function(c){c.stopPropagation(),a.showTree=!a.showTree,a.showTree&&b.on("click",d)},a.onFilterClicked=function(a){a.stopPropagation()},a.clearFilter=function(b){b.stopPropagation(),a.filterKeyword=""},a.canSelectItem=function(b){return a.callback({item:b,selectedItems:a.selectedItems})},a.itemSelected=function(b){function f(c){c.forEach(function(c){b.selected&&!c.selected?a.selectedItems.push(c):!b.selected&&c.selected&&a.selectedItems.splice(a.selectedItems.indexOf(c),1),c.selected=b.selected,c.children&&c.children.length>0&&f(c.children)})}if(!(a.useCallback&&a.canSelectItem(b)===!1||a.selectOnlyLeafs&&b.children&&b.children.length>0)){if(a.multiSelect){b.selected=!0;var d=a.selectedItems.indexOf(b);g(b)?(b.selected=!1,a.selectedItems.splice(d,1)):a.selectedItems.push(b),b.children&&b.children.length>0&&f(b.children)}else{e();for(var c=0;c<a.selectedItems.length;c++)a.selectedItems[c].selected=!1;b.selected=!0,a.selectedItems=[],a.selectedItems.push(b)}this.refreshOutputModel()}},a.onSelectAll=function(a,b){function c(a){a.selected=!0,a.children.length>0&&a.children.forEach(function(a){c(a)})}a.forEach(function(a){c(a)}),this.refreshSelectedItems(),this.refreshOutputModel()},a.onClearAll=function(a,b){function c(a){a.selected=!1,a.children.length>0&&a.children.forEach(function(a){c(a)})}a.forEach(function(a){c(a)}),this.refreshSelectedItems(),this.refreshOutputModel()}}]),a.directive("multiselectSearchtree",function(){return{restrict:"E",templateUrl:"src/multiselect-searchtree.tpl.html",scope:{inputModel:"=",outputModel:"=?",multiSelect:"=?",selectOnlyLeafs:"=?",callback:"&",defaultLabel:"@",extraButtons:"=?",directSearch:"=?"},link:function(a,b,c){function d(a,b){for(var c=e(a,[]),d=0,f=c.length;d<f;d++)if(c[d].name.toLowerCase().indexOf(b.toLowerCase())!==-1)return!1;return!0}function e(a,b){for(var c=0;c<a.children.length;c++)b.push(a.children[c]),e(a.children[c],b);return b}function f(a){a.isFiltered=!1,void 0!=a.p&&f(a.p)}function g(b,c){b.name.toLowerCase().indexOf(a.filterKeyword.toLowerCase())!==-1?f(b):b.isFiltered=!0,b.children.length>0&&angular.forEach(b.children,function(a){a.p=b,g(a)})}function h(b){b.name.toLowerCase().indexOf(a.filterKeyword.toLowerCase())!==-1?b.isFiltered=!1:d(b,a.filterKeyword)?b.isFiltered=!0:b.isFiltered=!1}c.callback&&(a.useCallback=!0),a.extraButtons&&(a.clearSearchIconStyle={right:"240px"}),a.$watch("inputModel",function(b){b&&(a.refreshSelectedItems(),a.refreshOutputModel())}),a.$watch("filterKeyword",function(){void 0!==a.filterKeyword&&(a.directSearch?angular.forEach(a.inputModel,function(a){g(a)}):angular.forEach(a.inputModel,function(a){h(a)}))})},controller:"multiSelectTreeCtrl"}})}(),function(){"use strict";var a=angular.module("multiselect-searchtree");a.controller("treeItemCtrl",["$scope",function(a){a.item.isExpanded!==!1&&a.item.isExpanded!==!0&&(a.item.isExpanded=!0),a.showExpand=function(a){return a.children&&a.children.length>0},a.onExpandClicked=function(a,b){b.stopPropagation(),a.isExpanded=!a.isExpanded},a.clickSelectItem=function(b,c){c.stopPropagation(),a.itemSelected&&a.itemSelected({item:b})},a.subItemSelected=function(b,c){a.itemSelected&&a.itemSelected({item:b})},a.activeSubItem=function(b,c){a.onActiveItem&&a.onActiveItem({item:b})},a.onMouseOver=function(b,c){c.stopPropagation(),a.onActiveItem&&a.onActiveItem({item:b})},a.showCheckbox=function(){return!!a.multiSelect&&(!a.selectOnlyLeafs&&(a.useCallback?a.canSelectItem(a.item):void 0))}}]),a.directive("treeItem",["$compile",function(a){return{restrict:"E",templateUrl:"src/tree-item.tpl.html",scope:{item:"=",itemSelected:"&",onActiveItem:"&",multiSelect:"=?",selectOnlyLeafs:"=?",isActive:"=",useCallback:"=",canSelectItem:"="},controller:"treeItemCtrl",compile:function(b,c,d){angular.isFunction(d)&&(d={post:d});var f,e=b.contents().remove();return{pre:d&&d.pre?d.pre:null,post:function(b,c,g){f||(f=a(e)),f(b,function(a){c.append(a)}),d&&d.post&&d.post.apply(null,arguments)}}}}}])}();